query: "select /* pgwatch_generated */\n    (extract(epoch from now()) * 1e9)::int8\
  \ as epoch_ns,\n    r, b, swpd, free, buff, cache, si, so, bi, bo, \"in\", cs, us,\
  \ sy, id, wa, st, cpu_count, load_1m, load_5m, load_15m, total_memory\nfrom\n  \
  \  get_vmstat()"
metrics: []
init_sql: "CREATE EXTENSION IF NOT EXISTS plpython3u; \n\nCREATE OR REPLACE FUNCTION\
  \ get_vmstat(\n    IN delay int default 1,\n    OUT r int, OUT b int, OUT swpd int8,\
  \ OUT free int8, OUT buff int8, OUT cache int8, OUT si int8, OUT so int8, OUT bi\
  \ int8,\n    OUT bo int8, OUT \"in\" int, OUT cs int, OUT us int, OUT sy int, OUT\
  \ id int, OUT wa int, OUT st int,\n    OUT cpu_count int, OUT load_1m float4, OUT\
  \ load_5m float4, OUT load_15m float4, OUT total_memory int8\n)\n    LANGUAGE plpython3u\n\
  AS $FUNCTION$\n    from os import cpu_count, popen\n    unit = 1024  # 'vmstat'\
  \ default block byte size\n\n    cpu_count = cpu_count()\n    vmstat_lines = popen('vmstat\
  \ {} 2'.format(delay)).readlines()\n    vm = [int(x) for x in vmstat_lines[-1].split()]\n\
  \    # plpy.notice(vm)\n    load_1m, load_5m, load_15m = None, None, None\n    with\
  \ open('/proc/loadavg', 'r') as f:\n        la_line = f.readline()\n        if la_line:\n\
  \            splits = la_line.split()\n            if len(splits) == 5:\n      \
  \          load_1m, load_5m, load_15m = splits[0], splits[1], splits[2]\n\n    total_memory\
  \ = None\n    with open('/proc/meminfo', 'r') as f:\n        mi_line = f.readline()\n\
  \        splits = mi_line.split()\n        # plpy.notice(splits)\n        if len(splits)\
  \ == 3:\n            total_memory = int(splits[1]) * 1024\n\n    return vm[0], vm[1],\
  \ vm[2] * unit, vm[3] * unit, vm[4] * unit, vm[5] * unit, vm[6] * unit, vm[7] *\
  \ unit, vm[8] * unit, \\\n        vm[9] * unit, vm[10], vm[11], vm[12], vm[13],\
  \ vm[14], vm[15], vm[16], cpu_count, load_1m, load_5m, load_15m, total_memory\n\
  $FUNCTION$;\n\nGRANT EXECUTE ON FUNCTION get_vmstat(int) TO pgwatch;\nCOMMENT ON\
  \ FUNCTION get_vmstat(int) IS 'created for pgwatch';"
