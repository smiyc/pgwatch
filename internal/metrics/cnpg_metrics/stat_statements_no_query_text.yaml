query: "with q_data as (\n  select /* pgwatch_generated */\n    (extract(epoch from\
  \ now()) * 1e9)::int8 as epoch_ns,\n    '-'::text as tag_query,\n    coalesce(queryid::text,\
  \ 'insufficient-privileges-total') as tag_queryid,\n    array_to_string(array_agg(distinct\
  \ quote_ident(pg_get_userbyid(userid))), ',') as users,\n    sum(s.calls)::int8\
  \ as calls,\n    round(sum(s.total_time)::numeric, 3)::double precision as total_time,\n\
  \    sum(shared_blks_hit)::int8 as shared_blks_hit,\n    sum(shared_blks_read)::int8\
  \ as shared_blks_read,\n    sum(shared_blks_written)::int8 as shared_blks_written,\n\
  \    sum(shared_blks_dirtied)::int8 as shared_blks_dirtied,\n    sum(temp_blks_read)::int8\
  \ as temp_blks_read,\n    sum(temp_blks_written)::int8 as temp_blks_written,\n \
  \   round(sum(blk_read_time)::numeric, 3)::double precision as blk_read_time,\n\
  \    round(sum(blk_write_time)::numeric, 3)::double precision as blk_write_time\n\
  \  from\n    pg_stat_statements s\n  where\n    calls > 5\n    and total_time >\
  \ 0\n    and dbid = (select oid from pg_database where datname = current_database())\n\
  \    and not upper(s.query) like any (array['DEALLOCATE%', 'SET %', 'RESET %', 'BEGIN%',\
  \ 'BEGIN;',\n      'COMMIT%', 'END%', 'ROLLBACK%', 'SHOW%'])\n  group by\n    queryid\n\
  )\nselect * from (\n  select\n    *\n  from\n    q_data\n  where\n    total_time\
  \ > 0\n  order by\n    total_time desc\n  limit 100\n) a\nunion\nselect * from (\n\
  \  select\n    *\n  from\n    q_data\n  order by\n    calls desc\n  limit 100\n\
  ) a\nunion\nselect * from (\n  select\n    *\n  from\n    q_data\n  where\n    shared_blks_read\
  \ > 0\n  order by\n    shared_blks_read desc\n  limit 100\n) a\nunion\nselect *\
  \ from (\n  select\n    *\n  from\n    q_data\n  where\n    shared_blks_written\
  \ > 0\n  order by\n    shared_blks_written desc\n  limit 100\n) a\nunion\nselect\
  \ * from (\n  select\n    *\n  from\n    q_data\n  where\n    temp_blks_read > 0\n\
  \  order by\n    temp_blks_read desc\n  limit 100\n) a\nunion\nselect * from (\n\
  \  select\n    *\n  from\n    q_data\n  where\n    temp_blks_written > 0\n  order\
  \ by\n    temp_blks_written desc\n  limit 100\n) a"
metrics: []
init_sql: CREATE EXTENSION IF NOT EXISTS pg_stat_statements;
